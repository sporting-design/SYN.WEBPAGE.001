<!doctype html>
<html
  class="no-js{% if request.design_mode %} shopify-design-mode{% endif %}"
  lang="{{ request.locale.iso_code }}"
>
  <head>
    <!-- Open Graph Meta Tags for Link Previews -->
    <meta property="og:title" content="Synapex – Kinesiology Tape for Athletes" />
    <meta property="og:description" content="Built for performance. Synapex kinesiology tape is engineered for elite athletes who demand durability, adhesion, and recovery support." />
    <meta property="og:image" content="https://cdn.shopify.com/s/files/1/0937/9050/3223/files/synapex-front-hero-img.png?v=1749829779" />
    <meta property="og:url" content="https://synapex.com/" />
    <meta property="og:type" content="website" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Synapex – Kinesiology Tape for Athletes" />
    <meta name="twitter:description" content="Built for performance. Synapex kinesiology tape is engineered for elite athletes who demand durability, adhesion, and recovery support." />
    <meta name="twitter:image" content="https://cdn.shopify.com/s/files/1/0937/9050/3223/files/synapex-front-hero-img.png?v=1749829779" />

    {%- render 'ecom_header' -%}
    {{ 'base.css' | asset_url | stylesheet_tag }}

    {%- if settings.favicon != blank -%}
      <link
        rel="icon"
        type="image/png"
        href="{{ settings.favicon | image_url: width: 32, height: 32 }}"
      >
    {%- endif -%}

    {% comment %} This a way to wait for main content to load when navigating to a new page so that the view transitions can work consistently {% endcomment %}
    <link
      rel="expect"
      href="#MainContent"
      blocking="render"
      id="view-transition-render-blocker"
    >

    {%- render 'meta-tags' -%}
    {%- render 'fonts' -%}
    {%- render 'scripts' -%}
    {%- render 'theme-styles-variables' -%}
    {%- render 'color-schemes' -%}

    {% if request.design_mode %}
      {%- render 'theme-editor' -%}
    {% endif %}

    {{ content_for_header }}
  </head>

  <body class="page-width-{{ settings.page_width }} card-hover-effect-{{ settings.card_hover_effect }}">
    {% render 'skip-to-content-link', href: '#MainContent', text: 'accessibility.skip_to_text' %}
    <div id="header-group">
      {% sections 'header-group' %}
    </div>

    <main
      id="MainContent"
      class="content-for-layout"
      role="main"
      data-page-transition-enabled="{{ settings.page_transition_enabled }}"
      data-product-transition="{{ settings.transition_to_main_product }}"
      data-template="{{ template }}"
    >
      {{ content_for_layout }}
    </main>

    {% sections 'footer-group' %}

    {% render 'search-modal' %}

    {% # theme-check-disable ParserBlockingScript %}
    <script src="{{ 'critical.js' | asset_url }}"></script>
    {% # theme-check-enable ParserBlockingScript %}

    {% if settings.quick_add or settings.mobile_quick_add %}
      {% render 'quick-add-modal' %}
    {% endif %}

  {%- comment -%}
  ════════════════════════════════════════════════════════════════
  PERSISTENT ENGAGEMENT VECTOR (PEV)
  Global floating CTA - Controlled via Theme Settings
  ════════════════════════════════════════════════════════════════
  {%- endcomment -%}
  {% if settings.pev_enable %}
  <a href="{{ settings.pev_link }}" id="synapex-pev" class="synapex-pev {% if template.name == 'product' %}pev-hidden{% endif %}">
    <span class="pev-icon">≠</span>
    <span class="pev-text">{{ settings.pev_text | default: 'SHOP THE STANDARD' }}</span>
  </a>

  <style>
    /* ════════════════════════════════════════
       PERSISTENT ENGAGEMENT VECTOR - CSS
       ════════════════════════════════════════ */
    :root {
      --pev-bg: {{ settings.pev_bg_color | default: '#FFFFFF' }};
      --pev-text: {{ settings.pev_text_color | default: '#000000' }};
    }

    .synapex-pev {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 999;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.5rem 1rem;
      background-color: var(--pev-bg);
      color: var(--pev-text);
      border: 2px solid var(--pev-text);
      border-radius: 50px;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
      text-decoration: none;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
      font-size: 0.75rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      white-space: nowrap;
      transition: all 0.3s ease-out;
      opacity: 1;
      pointer-events: auto;
    }

    .pev-icon { font-size: 1rem; line-height: 1; }
    .pev-text { line-height: 1; }

    /* HOVER STATE: INVERSION */
    .synapex-pev:hover {
      background-color: var(--pev-text);
      color: var(--pev-bg);
      border-color: var(--pev-bg);
      transform: translateX(-50%) translateY(-4px);
      box-shadow: 0 12px 32px rgba(0, 0, 0, 0.4);
    }

    .synapex-pev:active {
      transform: translateX(-50%) translateY(-1px);
    }

    .pev-hidden {
      opacity: 0 !important;
      pointer-events: none !important;
      bottom: -100px !important;
    }

    @media (max-width: 768px) {
      .synapex-pev { bottom: 16px; padding: 0.4375rem 0.875rem; font-size: 0.6875rem; }
    }
  </style>

  <script>
    (function() {
      'use strict';
      const pev = document.getElementById('synapex-pev');
      if (!pev) return;

      let ticking = false;

      function updatePEVVisibility() {
        const scrollY = window.scrollY;
        const windowHeight = window.innerHeight;
        const documentHeight = document.documentElement.scrollHeight;
        // Buffer zone to prevent footer overlap
        const scrolledToBottom = (scrollY + windowHeight) >= (documentHeight - 150);

        if (scrolledToBottom) {
          pev.classList.add('pev-hidden');
        } else {
          // Only show if NOT on product page
          {% unless template.name == 'product' %}
            pev.classList.remove('pev-hidden');
          {% endunless %}
        }
        ticking = false;
      }

      window.addEventListener('scroll', function() {
        if (!ticking) { window.requestAnimationFrame(updatePEVVisibility); ticking = true; }
      }, { passive: true });
      
      updatePEVVisibility();
    })();
  </script>
  {% endif %}

  {%- comment -%}ecom_footer snippet removed - footer now handled by footer-conscription section{%- endcomment -%}
</body>
</html>